@page "/"
@using BlazorApp.Components.Base
@inject NavigationManager NavigationManager
@inject ProtectedLocalStorage ProtectedLocalStore
@inject ProtectedSessionStorage ProtectedSessionStorage
@layout MainLayout
@inject BlazorApp.Data.LoadingService loadingService

<PageTitle>Blue Skies - Home</PageTitle>

<div class="fade-in-enter-active">
  @if (isLoaded){
    @if(isAd){
        loadingService.ShowLoadingScreen();
        NavigationManager.NavigateTo("/admin/keys");
    } else {
        <div class="w-full">
            <BlazorApp.Components.Home.Hero />

            @* How it works *@
            <div class="mt-20">
            <BlazorApp.Components.Home.HowItWorks />
            </div>
            
            @* Unlock your full potential *@
            <BlazorApp.Components.Home.CTA />

            @* Frequently Asked Questions *@
            <div class="mt-72 lg:mt-44 mb-40">
            <BlazorApp.Components.Home.FAQ />
            </div>
        </div>
    }
  }
</div>


@code {
  private bool isAd = false;
  private bool isLoaded = false;

/// <summary>
/// On page load, check if user is admin
/// </summary>
  protected override async Task OnInitializedAsync()
  {
    var isAdmin = await ProtectedLocalStore.GetAsync<bool>("isAdmin");
    await ProtectedSessionStorage.SetAsync("parent", "index");
    isAd = isAdmin.Value;
    isLoaded = true;
    loadingService.HideLoadingScreen();
  }

/// <summary>
/// Navigate to register page
/// </summary>
  void Register()
  {
    loadingService.ShowLoadingScreen();
    NavigationManager.NavigateTo("/register");
  }
}